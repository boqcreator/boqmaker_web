<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>Add BOQ Item</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-segment [(ngModel)]="segment" >
    <ion-segment-button value="cat">
      <ion-label>Category</ion-label>
    </ion-segment-button>
    <ion-segment-button value="subcat">
      <ion-label>Subcategory</ion-label>
    </ion-segment-button>
    <ion-segment-button value="subsubcat">
      <ion-label>Sub subcategory</ion-label>
    </ion-segment-button>
    <ion-segment-button value="boqitem">
      <ion-label>Item</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div [ngSwitch]="segment">
    <div style="margin-top : 10px;" *ngSwitchCase="'cat'">
      <ion-list>
        <ion-item>
          <ion-label position="floating">Name<ion-text color="danger">*</ion-text></ion-label>
          <ion-input [(ngModel)]="catName" type="text" placeholder="Enter category name here..."></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Description</ion-label>
          <ion-textarea [(ngModel)]="catDes" placeholder="Enter description here..."></ion-textarea>
        </ion-item>
      </ion-list>
      <ion-button [disabled]="catName.length > 0 ? false : true" (click)="addcat()" expand="block">
        Add
      </ion-button>

      </div>

      <div style="margin-top : 10px;" *ngSwitchCase="'subcat'">
        <ion-list>
          <ion-item>
            <ion-label class="ion-text-wrap" >Category</ion-label>
            <ion-select (ionChange)="getSubcat()" [(ngModel)]="CatID" placeholder="Select Category">
              <ion-select-option  *ngFor="let item of catList" [value]="item.id">{{ item.name }}</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item>
            <ion-label position="floating">Name<ion-text color="danger">*</ion-text></ion-label>
            <ion-input [(ngModel)]="subcatName" type="text" placeholder="Enter category name here..."></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="floating">Description</ion-label>
            <ion-textarea [(ngModel)]="subcatDes" placeholder="Enter description here..."></ion-textarea>
          </ion-item>
        </ion-list>
        <ion-button [disabled]="subcatName.length > 0 ? false : true" (click)="addsubcat()" expand="block">
          Add
        </ion-button>
      </div>

      <div style="margin-top : 10px;" *ngSwitchCase="'subsubcat'">
        <ion-list>
          <ion-item>
            <ion-label class="ion-text-wrap" >Category</ion-label>
            <ion-select (ionChange)="getSubcat()" [(ngModel)]="CatID" placeholder="Select Category">
              <ion-select-option  *ngFor="let item of catList" [value]="item.id">{{ item.name }}</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item>
            <ion-label class="ion-text-wrap">Subcategory</ion-label>
            <ion-select (ionChange)="getSubsubcat()" [(ngModel)]="SubcatID" placeholder="Select Sub category">
              <ion-select-option *ngFor="let item of subcatList" [value]="item.id">{{ item.name }}</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item>
            <ion-label position="floating">Name<ion-text color="danger">*</ion-text></ion-label>
            <ion-input [(ngModel)]="SubsubcatName" type="text" placeholder="Enter sub-subcategory name here..."></ion-input>
          </ion-item>
          <ion-item>
            <ion-label>Description</ion-label>
            <ion-textarea [(ngModel)]="SubsubcatDes" placeholder="Enter description here..."></ion-textarea>
          </ion-item>
        </ion-list>
        <ion-button [disabled]="SubsubcatName.length > 0 ? false : true" (click)="addSubsubcat()" expand="block">
          Add
        </ion-button>
        </div>

        <div style="margin-top : 10px;" *ngSwitchCase="'boqitem'">
          <ion-card>
            <ion-row>
              <ion-col>
                <ion-item>
                  <ion-label class="ion-text-wrap" >Category</ion-label>
                  <ion-select (ionChange)="getSubcat()" [(ngModel)]="CatID" placeholder="Select Category">
                    <ion-select-option  *ngFor="let item of catList" [value]="item.id">{{ item.name }}</ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-col>
              <ion-col>
                <ion-item>
                  <ion-label class="ion-text-wrap">Subcategory</ion-label>
                  <ion-select (ionChange)="getSubsubcat()" [(ngModel)]="SubcatID" placeholder="Select Sub category">
                    <ion-select-option *ngFor="let item of subcatList" [value]="item.id">{{ item.name }}</ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-col>
              <ion-col>
                <ion-item>
                  <ion-label class="ion-text-wrap">Sub subcategory</ion-label>
                  <ion-select (ionChange)="saveTostorage()" [(ngModel)]="SubsubcatID" placeholder="Select Sub subcategory">
                    <ion-select-option *ngFor="let item of subsubcatList" [value]="item.id">{{ item.name }}</ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-col>
            </ion-row>

            <ion-row>
              <ion-col>
                <ion-item>
                  <ion-label position="floating">Item Name <ion-text color="danger">*</ion-text></ion-label>
                  <ion-input required [(ngModel)]="itemname" type="text"></ion-input>
                </ion-item>
              </ion-col>
              <ion-col>
                <ion-item>
                  <ion-label>Unit</ion-label>
                  <ion-select [(ngModel)]="unit" placeholder="Select item unit">
                    <ion-select-option *ngFor="let item of units" [value]="item">{{ item }}</ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-col>
              <ion-col>
                <ion-item>
                  <ion-label>Unit price</ion-label>
                  <input currencyMask style="color: teal;" [(ngModel)]="price" [options]="{ prefix: 'BHD ', thousands: ',', decimal: '.', precision: '3',align: 'left' }"/>
                </ion-item>
              </ion-col>
            </ion-row>
          </ion-card>
          <ion-card-header>
            <ion-card-title>Materials</ion-card-title>
          </ion-card-header>

          <ion-list>
            <ion-row>
              <ion-col>
                <ion-item>
                  <ion-label class="ion-text-wrap" >Material Category</ion-label>
                  <ion-select (ionChange)="getMsubcat()" [(ngModel)]="MCatID" placeholder="Select material Category">
                    <ion-select-option  *ngFor="let item of McatList" [value]="item.id">{{ item.name }}</ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-col>
              <ion-col>
            <ion-item>
              <ion-label>Material Subcategory</ion-label>
              <ion-select (ionChange)="getmaterials()" [(ngModel)]="MSubcatID" placeholder="Select Subcategory">
                <ion-select-option *ngFor="let item of MsubcatList" [value]="item.id">{{ item.name }}</ion-select-option>
              </ion-select>
            </ion-item>
              </ion-col>
              <ion-col>
                <ion-item>
                  <ion-label>Materials</ion-label>
                  <ion-select (ionChange)="calculate()"  multiple="true"  [(ngModel)]="material" placeholder="Select material">
                    <ion-select-option *ngFor="let item of materialList" [value]="item">{{ item.name }}</ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-col>
            </ion-row>
          </ion-list>


          <ion-list>
            <ion-card *ngFor="let mat of material" >
               <ion-card-header>
                 <ion-card-title>{{mat.name}}</ion-card-title>
               </ion-card-header>
               <ion-row>
                 <ion-col style="padding-left: 10px;">

                    <ion-text>
                      <ion-label>
                        Unit : {{mat.unit}}
                      </ion-label> <br/>
                      <ion-label>
                       Price : {{mat.price}}
                     </ion-label>
                     </ion-text>
                     <h6>Supplier</h6>
                     <p>
                      Name : {{mat.supplier.name}} <br/>
                      Email : {{mat.supplier.email}} <br/>
                      Phone no: {{mat.supplier.no}} <br/>
                    </p>
                 </ion-col>

                 <ion-col>
                   <ion-item>
                     <ion-label position="floating">Percentage %</ion-label>
                     <ion-input (ionChange)="calculate()" [(ngModel)]="mat.Per" value=100 type="number"></ion-input>
                   </ion-item>
                   <ion-item>
                    <ion-label position="floating">Wastage percentage %</ion-label>
                    <ion-input (ionChange)="calculate()" [(ngModel)]="mat.WPer" value=0 type="number"></ion-input>
                  </ion-item>
                  <ion-item>
                    <ion-label position="floating">Quantity</ion-label>
                    <ion-input (ionChange)="calculate()" [(ngModel)]="mat.qty" value=1 type="number"></ion-input>
                  </ion-item>
                 </ion-col>
               </ion-row>

            </ion-card>
          </ion-list>
          
          <ion-button [disabled]="itemname.length > 0 && CatID && SubcatID && SubsubcatID && unit ? false : true" (click)="addboqitem()" expand="block"  >
            Add
          </ion-button>

          <ion-card>

          </ion-card>

        </div>


      </div>

</ion-content>
